# vimwiki-publishing-system

(Note the name is probably going to change).

The premise: allow writing in vimwiki, and publish as a website.

It's actually in two parts:

* A page formatter for the `Vimwiki2HTML` command.
* A site producer that uses files according to a `site.yaml` or similarly named
  file.

The second option is much more interesting as it forms the basis for generating
arbitrary sites from pages that can be authored (and linked) in vimwiki.  It
also means that *other* editors could be used, which might make it useful for
other people.

Thus there are two executables generated by this application:

* `vm2html` -- callable from `:Vimwiki2HTML` and related
  commands.
* `sitegen` -- use a `site.yaml` to generate a set of HTML files from the files
  within the same wiki doc.

# The Site generator

(This is the `sitegen` command, not the `vm2html` command.)

## Features that would be useful for the output sites

* Tags - generate a page of tags, and a page for each tag.
* Categories - generate a page of categories, and a page for each category.
* Drafts (i.e. not publishing a page that is a draft)
* Removing links that point at drafts.
* Front page generation using template?
* Working with Pandoc markdown syntax.
* A YAML config to indicate templates, etc.

## How does  work?

The user creates and edits pages as normal in Pandoc pages and links.  i.e. It
looks like a normal wiki of interconnected pages.  Vimwiki can navigate around
those pages assuming it is configured appropriately.  Vimwiki can also 'publish'
those pages using `VimwikiAll2HTML` which would convert every page.  In this
case, the `vm2html` would just remove the `sitegen` specific page config and
generate individual wiki pages.

However, if there are no `sitegen` config sections on any pages, then no site
will be generated (apart from, perhaps, the index page, but with no content).

But first there must be a `site.yaml`.  Then pages that should be published in
the site must have a `sitegen` config section at the top of the page to indicate
that it should be included in the site.

### The `site.yaml` config file

The configuration/control for the site build will be in a yaml file.  This will
specify the source and destination directories, how different parts are mapped
and what features are enabled in the site build.  Also, the location of template
files, and how they are controlled.


```yaml
# key/values available in the site's YAML document
# the values provided are the default values
---
site: <site-identifier>
source: ./src  # the directory (relative, if wanted, to the site.yaml) to start
               # looking for sitegen pages.
output-dir: ./html
extension: .md # the extension of files that may be sitegen page parts
index-page-name: index # string representing the custom page name for the index
templates-dir: ./templates # directory to find templates
template-ext: .html  # the extension used for templates
css-dir: ./templates/css  # directory to find css files.
default-style: style.css  # name of the default style sheet.
generate-tags: true  # should sitegen generate a tags page
generate-categories: true  # should sitegen generate categories
```

(there is probably more there)

### The `sitegen` config in the page

For a page to be recognised by `sitegen` it needs to have a header than
identifies the page (or page fragment) as a page to be processed.

`sitegen` recognises three hyphens `--- <keyword>` as a `sitegen` instruction.
This will be stripped out of the page and processed.  The `sitegen` config in
a page can include:

```yaml
--- sitegen
title: The page <title> value
template: default  # the template file (minus .extension) to render this page with
style: style.css   # the style sheet to apply to this page.
tags: [tag1, tag2] # tags to apply to the page
category: cat1     # The SINGLE category to apply to the page.
date: 2019-10-11   # The Date/time to apply to the page
updated: 2019-10-12 # Date/time the page was updated.
slug: some/slug-name  # The permanent slug to use for this page.
site-page: index   # Use this page as the index (see later)
author: [tinwood]  # Authors of this page.
draft: true        # The default is true; set to false to actually publish it.
site: <site-identifier> # the site that this belongs to.
<maybe more>
```

### The `sitegen` program

The `sitegen` program is what builds the site.  Essentially, what we want it to
do is a) read the `site.yaml` file, read through the pages on the site and
extract the `sitegen` header, and then generate the pages.

It would be cool, in a further iteration, to be able to watch a directory and
regenerate the pages as they are changed.

However, initially, we're just going to process the files as we see them, and
then in future iterations, not process files that have already been done
previously.

So the only command we need is:

```bash
$ sitegen [-c site.yaml]
```

That is, it just generates the site.

